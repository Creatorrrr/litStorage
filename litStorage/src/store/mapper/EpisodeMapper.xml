<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
    <mapper namespace="store.mapper.EpisodeMapper">
    
    	  <resultMap type="Episode" id="EpisodeMap">
			<id property="id" column="id"/>
			<result property="title" column="name"/>
			<result property="content" column="content"/>
			<!-- 
	  		<association property="creator" column="writer" 
				select="store.mapper.MemberMapper.selectMemberById" 
				javaType="Member" jdbcType="VARCHAR"/> 
			-->
			<result property="bound" column="bound"/>
			
			<!-- 
			<collection property="histories" column="id" 
				select="store.mapper.ChangeHistoryMapper.selectChangeHistoriesByEpisodeId"
				javaType="ArrayList" jdbcType="VARCHAR"/>
			 
			<association property="literature" column="id" 
				select="store.mapper.LiteratureMapper.selectLiteraturesByLitStorageId" 
				javaType="Literature" jdbcType="VARCHAR"/>
			-->
	  	</resultMap>
    
    	<insert id="insertEpisode">
    		<selectKey keyProperty="id" resultType="string" order="BEFORE">
				select EPISODE_SEQ.nextval FROM DUAL
			</selectKey>
    		insert into episode(id, name, content, writer, bound, literature )
			values(#{id},#{title},#{content},#{writer.id},#{bound},#{literature.id})
    	</insert>
    	
    	<update id="updateEpisode">
    		update episode set name=#{title}, content=#{content}, writer=#{writer.id}, bound=#{bound}, literature=#{literature.id} where id=#{id}
    	</update>
    
    	<delete id="deleteEpisode">
    		delete from episode where id=#{id}
    	</delete>
    
    
    	<select id="selectEpisodeByid" resultMap="EpisodeMap">
    		select id, name, content, writer, bound, literature from episode where id = #{id}
    	</select>
    
    	<select id="selectEpisodesByLiteratureId" resultMap="EpisodeMap">
    		select id, name, content, writer, bound, literature from episode where literature = #{literatureId}
    	</select>
    	
    	<update id="updateBound">
    		update episode set bound=#{bound}
    	</update>
    
    
    </mapper>